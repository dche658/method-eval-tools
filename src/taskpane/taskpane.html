<!-- See License in the project root for license information. -->

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Method Evaluation Tools Add-in</title>

    <!-- Office JavaScript API -->
    <script
      type="text/javascript"
      src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"
    ></script>

    <!-- For more information on Fluent UI, visit https://developer.microsoft.com/fluentui#/. -->
    <link
      rel="stylesheet"
      href="https://res-1.cdn.office.net/files/fabric-cdn-prod_20230815.002/office-ui-fabric-core/11.1.0/css/fabric.min.css"
    />

    <!-- Template styles -->
    <link href="taskpane.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="ms-font-m ms-welcome ms-Fabric ms-bgColor-neutralLighter">
    <!-- <header class="ms-welcome__header ms-bgColor-neutralQuaternary">
      <h1 class="ms-font-xl">Method Evaluation Tools</h1>
    </header> -->
    <!-- Comment out this section in production -->
    <section id="sideload-msg" class="ms-welcome__main">
      <h2 class="ms-font-xl">
        Please
        <a
          rel="noopener noreferrer"
          target="_blank"
          href="https://learn.microsoft.com/office/dev/add-ins/testing/test-debug-office-add-ins#sideload-an-office-add-in-for-testing"
          >sideload</a
        >
        your add-in to see app body.
      </h2>
    </section>
    <main id="app-body" class="ms-welcome__main mvw-hidden">
      <!-- remove mvw-hidden class in production -->
      <fluent-accordion expand-mode="single">
        <fluent-accordion-item>
          <span slot="heading">Performance Specifications</span>
          <div class="panel ms-font-m">
            <p>
              Analytical Performance Specifications may be entered manually or selected from a range
              of cells in the Excel worksheet. If nothing is entered, nothing will be plotted on the
              charts.
            </p>
            <div class="container">
              <div class="mt-3">
                <fluent-checkbox id="import-aps" checked>Import from Excel</fluent-checkbox>
              </div>
              <div class="mt-3">
                <fluent-text-field id="aps-abs">
                  <div class="range-label">
                    <span>APS Absolute</span>
                    <i
                      id="select-abs-aps-address"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div class="mt-3">
                <fluent-text-field id="aps-rel">
                  <div class="range-label">
                    <span>APS Relative</span>
                    <i
                      id="select-rel-aps-address"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
            </div>
          </div>
        </fluent-accordion-item>
        <fluent-accordion-item expanded>
          <span slot="heading">Analyse Comparison</span>
          <div class="panel ms-font-m">
            <div class="container">
              <div>
                <fluent-text-field id="x-range" title="Cells containing the reference method data.">
                  <div class="range-label">
                    <span>X Range</span>
                    <i
                      id="select-x-range"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div>
                <fluent-text-field id="y-range" title="Cells containing the test method data.">
                  <div class="range-label">
                    <span>Y Range</span>
                    <i
                      id="select-y-range"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div>
                <fluent-text-field id="output-range" title="Top-left cell for outputting results.">
                  <div class="range-label">
                    <span>Output Range</span>
                    <i
                      id="select-output-range"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div class="mt-3">
                  <fluent-checkbox id="output-labels" title="Add labels to the results"
                    checked>Label output</fluent-checkbox
                  >
                </div>
              <div class="mt-3">
                <span class="ms-font-m">Regression Method</span>
                <fluent-select id="regression-method">
                  <fluent-option value="paba">Passing-Bablok</fluent-option>
                  <fluent-option value="deming">Deming</fluent-option>
                  <fluent-option value="wdeming">Weighted Deming</fluent-option>
                </fluent-select>
              </div>
              <div class="mt-3">
                <span class="ms-font-m">Confidence Interval Method</span>
                <fluent-select id="confidence-interval-method">
                  <fluent-option value="default">Default</fluent-option>
                  <fluent-option value="bootstrap">Bootstrap</fluent-option>
                </fluent-select>
              </div>
              <div id="error-ratio-container" class="mt-3 mvw-hidden">
                <fluent-checkbox
                  id="use-calculated-error-ratio"
                  title="Calculated error ratio can only be used with Deming or Weighted Deming regression if the comparison was performed in duplicate."
                >
                  Use Calculated Error Ratio
                </fluent-checkbox>
                <fluent-text-field id="error-ratio" value="1.0">
                  <div class="range-label">
                    <span>Error Ratio s<sub>y</sub><sup>2</sup>/s<sub>x</sub><sup>2</sup></span>
                  </div>
                </fluent-text-field>
              </div>
              <div class="mt-3">
                <div>
                  <hr />
                  <div>
                    <span class="section-title ms-fontColor-themePrimary">Charts</span>
                  </div>
                  <fluent-text-field
                    id="bland-altman-range"
                    title="Cells over which to plot the Bland-Altman chart."
                  >
                    <div class="range-label">
                      <span>Bland-Altman Range</span>
                      <i
                        id="select-bland-altman-range"
                        class="ms-Icon ms-font-xl ms-Icon--OEM"
                        title="Click to enter the address of the selected cells."
                      ></i>
                    </div>
                  </fluent-text-field>
                </div>
                <div class="mt-3">
                  <span class="ms-font-m">Difference Type</span>
                  <fluent-select id="difference-type">
                    <fluent-option value="rel">Relative</fluent-option>
                    <fluent-option value="abs">Absolute</fluent-option>
                  </fluent-select>
                </div>
                <div>
                  <fluent-text-field
                    id="scatter-plot-range"
                    title="Cells over which to plot the Scatter Plot chart."
                  >
                    <div class="range-label">
                      <span>Scatter Plot Range</span>
                      <i
                        id="select-scatter-plot-range"
                        class="ms-Icon ms-font-xl ms-Icon--OEM"
                        title="Click to enter the address of the selected cells."
                      ></i>
                    </div>
                  </fluent-text-field>
                </div>
                <div>
                  <fluent-text-field
                    id="chart-data-range"
                    title="Top-left cell for outputting data used for constructing the charts."
                  >
                    <div class="range-label">
                      <span>Chart Data Output</span>
                      <i
                        id="select-chart-data-range"
                        class="ms-Icon ms-font-xl ms-Icon--OEM"
                        title="Click to enter the address of the selected cells."
                      ></i>
                    </div>
                  </fluent-text-field>
                </div>
              </div>
              <div class="mt-3">
                <fluent-button id="run-regression" class="ms-fontColor-themePrimary"
                  >Run</fluent-button
                >
              </div>
              <fluent-accordion class="mt-3">
                <fluent-accordion-item>
                  <span slot="heading">Cohen's Kappa</span>
                  <div class="mt-3">
                    <div>
                      Specify cutoffs for each method to assess concordance. Each method must have
                      the same number of cutoffs.
                    </div>
                    <table>
                      <thead>
                        <tr>
                          <td>X Cutoffs</td>
                          <td>Y Cutoffs</td>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td><fluent-number-field id="x-threshold-0"></fluent-number-field></td>
                          <td><fluent-number-field id="y-threshold-0"></fluent-number-field></td>
                        </tr>
                        <tr>
                          <td><fluent-number-field id="x-threshold-1"></fluent-number-field></td>
                          <td><fluent-number-field id="y-threshold-1"></fluent-number-field></td>
                        </tr>
                        <tr>
                          <td><fluent-number-field id="x-threshold-2"></fluent-number-field></td>
                          <td><fluent-number-field id="y-threshold-2"></fluent-number-field></td>
                        </tr>
                        <tr>
                          <td><fluent-number-field id="x-threshold-3"></fluent-number-field></td>
                          <td><fluent-number-field id="y-threshold-3"></fluent-number-field></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="mt-3">
                    <fluent-text-field id="concordance-output">
                      <div class="range-label">
                        <span>Concordance Output Range</span>
                        <i
                          id="select-concordance-output-range"
                          class="ms-Icon ms-font-xl ms-Icon--OEM"
                          title="Click to enter the address of the selected cells."
                        ></i>
                      </div>
                    </fluent-text-field>
                  </div>
                </fluent-accordion-item>
              </fluent-accordion>
            </div>
          </div>
        </fluent-accordion-item>
        <fluent-accordion-item>
          <span slot="heading">Analyse Precision</span>
          <div class="panel ms-font-m">
            <div class="container">
              <div>
                Use this section to analyse the imprecision of an assay. The calculations are based
                on those described by CLSI EP15 and EP05.
              </div>
              <div>
                <fluent-text-field id="p-days-range" title="Column for the days (factor A).">
                  <div class="range-label">
                    <span>Days Range</span>
                    <i
                      id="select-p-days-range"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div>
                <fluent-text-field id="p-runs-range" title="Column for the runs (factor B).">
                  <div class="range-label">
                    <span>Runs Range</span>
                    <i
                      id="select-p-runs-range"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div>
                <fluent-text-field id="p-results-range" title="Columns for the results.">
                  <div class="range-label">
                    <span>Results Range</span>
                    <i
                      id="select-p-results-range"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div>
                <fluent-button id="check-for-outliers"  class="ms-fontColor-themePrimary">
                  Grubb's Test For Outliers
                </fluent-button>
              </div>
              <div>
                <fluent-text-field
                  id="p-output-range"
                  title="Top-left cell for outputting results."
                >
                  <div class="range-label">
                    <span>Output Range</span>
                    <i
                      id="select-p-output-range"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div>
                <fluent-button id="run-precision" class="ms-fontColor-themePrimary"
                  >Run</fluent-button
                >
              </div>
            </div>
          </div>
        </fluent-accordion-item>
        <fluent-accordion-item>
          <span slot="heading">Precision Layout</span>
          <div class="panel ms-font-m">
            <div class="container">
              <div>
                Use this section to setup a layout in Excel to assess an assays imprecision. It can
                be used for both verification and validation studies.
              </div>
              <div class="mt-3">
                <fluent-number-field
                  id="c-num-days"
                  title="Number of days over which to run the experiment."
                  value="5"
                >
                  Days
                </fluent-number-field>
              </div>
              <div class="mt-3">
                <fluent-number-field id="c-num-runs" title="Number of runs per day." value="1">
                  Runs per day
                </fluent-number-field>
              </div>
              <div class="mt-3">
                <fluent-number-field
                  id="c-num-reps"
                  title="Number of replicates per run."
                  value="5"
                >
                  Replicates per run
                </fluent-number-field>
              </div>
              <div class="mt-3">
                <fluent-number-field
                  id="c-num-levels"
                  title="Number of levels to be assessed."
                  value="4"
                >
                  Number of levels
                </fluent-number-field>
              </div>
              <div class="mt-3">
                <fluent-text-field id="c-layout-range" title="Top-left cell for the layout.">
                  <div class="range-label">
                    <span>Layout Range</span>
                    <i
                      id="select-c-layout-range"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div class="mt-3">
                <fluent-button id="setup-precision" class="ms-fontColor-themePrimary"
                  >Setup</fluent-button
                >
              </div>
            </div>
          </div>
        </fluent-accordion-item>
        <fluent-accordion-item>
          <span slot="heading">Qualitative Comparison</span>
          <div class="panel ms-font-m">
            <div class="container">
              <div>
                Assess concordance of qualitative data and calculate Cohen's Kappa.
              </div>
              <div>
                <fluent-text-field id="qx-range" title="Cells containing the reference method results.">
                  <div class="range-label">
                    <span>X Range</span>
                    <i
                      id="select-qx-range"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div>
                <fluent-text-field id="qy-range" title="Cells containing the test method results.">
                  <div class="range-label">
                    <span>Y Range</span>
                    <i
                      id="select-qy-range"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div>
                <fluent-text-field id="q-output-range" title="Top-left cell for outputting results.">
                  <div class="range-label">
                    <span>Output Range</span>
                    <i
                      id="select-q-output-range"
                      class="ms-Icon ms-font-xl ms-Icon--OEM"
                      title="Click to enter the address of the selected cells."
                    ></i>
                  </div>
                </fluent-text-field>
              </div>
              <div class="mt-3">
                <fluent-button id="qual-comparison" class="ms-fontColor-themePrimary"
                  >Run</fluent-button
                >
              </div>
            </div>
          </div>
        </fluent-accordion-item>
        <fluent-accordion-item>
          <span slot="heading">Set Range Defaults</span>
          <div class="panel ms-font-m">
            <div class="mt-3">
              <p>
                This add in was developed for use with the associated Method Verification Workbook.
                The default cell ranges used by the workbook can be populated by clicking the button
                below.
              </p>
              <fluent-button id="load-defaults-btn" class="ms-fontColor-themePrimary"
                >Set MVW Defaults</fluent-button
              >
              <p>
                Alternatively, the defaults for a user defined template can defined in a worksheet
                and loaded from that page. The definitions need to be supplied in two columns from
                cells A2:B20. The first column should give the name of the attribute as it appears
                below. The second column must contain the values to be copied. A1 and B1 can be 
                column headers but they are not read.
              </p>
              <fluent-button id="load-wb-def-btn" 
              class="ms-fontColor-themePrimary">Set Custom Defaults</fluent-button
              >
              <div class="mt-3">
              <table>
                <thead>
                  <tr>
                    <th>Attribute</th>
                    <th>Value</th>
                  </tr>
                </thead>
                <tbody>
                <tr>
                  <td>import-aps</td>
                  <td>TRUE</td>
                </tr>
                <tr>
                  <td>aps-abs</td>
                  <td>J4</td>
                </tr>
                <tr>
                  <td>aps-rel</td>
                  <td>J6</td>
                </tr>
                <tr>
                  <td>x-range</td>
                  <td>O61:P160</td>
                </tr>
                <tr>
                  <td>y-range</td>
                  <td>R61:S160</td>
                </tr>
                <tr>
                  <td>output-range</td>
                  <td>C167</td>
                </tr>
                <tr>
                  <td>regression-method</td>
                  <td>paba, deming, or wdeming</td>
                </tr>
                <tr>
                  <td>confidence-interval-method</td>
                  <td>default or bootstrap</td>
                </tr>
                <tr>
                  <td>use-calculated-error-ratio</td>
                  <td>FALSE</td>
                </tr>
                <tr>
                  <td>error-ratio</td>
                  <td>1.0</td>
                </tr>
                <tr>
                  <td>bland-altman-range</td>
                  <td>N162:U175</td>
                </tr>
                <tr>
                  <td>scatter-plot-range</td>
                  <td>N177:U190</td>
                </tr>
                <tr>
                  <td>output-labels</td>
                  <td>TRUE</td>
                </tr>
                <tr>
                  <td>chart-data-range</td>
                  <td>AP61</td>
                </tr>
                <tr>
                  <td>p-days-range</td>
                  <td>B300:B324</td>
                </tr>
                <tr>
                  <td>p-runs-range</td>
                  <td>C300:C324</td>
                </tr>
                <tr>
                  <td>p-results-range</td>
                  <td>D300:G324</td>
                </tr>
                <tr>
                  <td>p-output-range</td>
                  <td>W299</td>
                </tr>
                <tr>
                  <td>concordance-output</td>
                  <td>C176</td>
                </tr>
                <tr>
                  <td>qx-range</td>
                  <td>E61:E160</td>
                </tr>
                <tr>
                  <td>qy-range</td>
                  <td>H61:H160</td>
                </tr>
                <tr>
                  <td>q-output-range</td>
                  <td>C176</td>
                </tr>
                </tbody>
              </table>
              </div>
            </div>
          </div>
        </fluent-accordion-item>
        <fluent-accordion-item>
          <span slot="heading">About</span>
          <div class="panel ms-font-m">
            <p>
              The purpose of this add-in is to provide some statistical procedures that are
              necessary for assessing clinical laboratory methods but are not easy to implement
              using builtin Excel spreadsheet functions. It is not meant to be a comprehensive
              statistical analysis tool. The current interation allows the user to perform linear
              regression techniques including Passing-Bablok, Deming, and Weighted Deming.
              Procedures are also provided to allow users to analyse variance components as described
              in CLSI EP15 and EP05.
            </p>
            <p>
              Source code is available on GitHub at
              <a href="https://github.com/dche658/method-eval-tools">
                https://github.com/dche658/method-eval-tools </a
              >.
            </p>
            <p>
              THIS CODE IS PROVIDED AS IS WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR 
              IMPLIED, INCLUDING ANY IMPLIED WARRANTIES OF FITNESS FOR A PARTICULAR PURPOSE,
              MERCHANTABILITY, OR NON-INFRINGEMENT.
            </p>
          </div>
        </fluent-accordion-item>
      </fluent-accordion>
      <!-- Message Box for displaying errors -->
      <div id="msgbox" class="mvw-hidden floating-msgbox">
        <div id="msgbox-content">
          <!-- Message content goes here -->
        </div>
        <div class="msgbox-footer">
          <fluent-button id="alert-ok-btn" class="ms-fontColor-themePrimary">OK</fluent-button>
        </div>
      </div>
    </main>
    <!-- 
        The script below makes the following div display if the
        webview is Trident, and hides the regular div. 
    -->
    <div id="tridentmessage" class="mvw-hidden">
      This add-in will not run in your version of Office. Please upgrade either to perpetual Office
      2021 (or later) or to a Microsoft 365 account.
    </div>
    <script>
      if (navigator.userAgent.indexOf("Trident") !== -1) {
        var tridentMessage = document.getElementById("tridentmessage");
        var normalUI = document.getElementById("main");
        tridentMessage.style.display = "block";
        normalUI.style.display = "none";
      }
    </script>
  </body>
</html>
